<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Applicability domain methods for continuous data • applicable</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../tidyverse-2.css" rel="stylesheet">
<meta property="og:title" content="Applicability domain methods for continuous data">
<meta property="og:description" content="applicable">
<meta property="og:image" content="https://applicable.tidymodels.org/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">applicable</a>
        <div class="info">
          <span class="partof">part of <a href="https://tidymodels.org">tidymodels</a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/binary-data.html">Applicability domain methods for binary data</a>
    </li>
    <li>
      <a href="../articles/continuous-data.html">Applicability domain methods for continuous data</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/tidymodels/applicable/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="continuous-data_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Applicability domain methods for continuous data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/applicable/blob/master/vignettes/continuous-data.Rmd"><code>vignettes/continuous-data.Rmd</code></a></small>
      <div class="hidden name"><code>continuous-data.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">applicable</span>)</pre></body></html></div>
<p><code>applicable</code> provides the following methods to analyze the applicability domain of your model:</p>
<ul>
<li>Principal component analysis</li>
<li>Hat values statistics</li>
</ul>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>We will use the Ames IA housing data for our example.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">AmesHousing</span>)
<span class="no">ames</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AmesHousing/man/make_ames.html">make_ames</a></span>()</pre></body></html></div>
<p>There are 2,930 properties in the data.</p>
<p>The Sale Price was recorded along with 81 predictors, including:</p>
<ul>
<li>Location (e.g. neighborhood) and lot information.</li>
<li>House components (garage, fireplace, pool, porch, etc.).</li>
<li>General assessments such as overall quality and condition.</li>
<li>Number of bedrooms, baths, and so on.</li>
</ul>
<p>More details can be found in <a href="http://ww2.amstat.org/publications/jse/v19n3/decock.pdf">De Cock (2011, Journal of Statistics Education)</a>.</p>
<p>The raw data are at <a href="http://bit.ly/2whgsQM"><code>http://bit.ly/2whgsQM</code></a> but we will use a processed version found in the <a href="https://github.com/topepo/AmesHousing"><code>AmesHousing</code></a> package. <code>applicable</code> also contains an update for these data for three new properties (although fewer fields were collected on these).</p>
<p>To pre-process the training set, we will use the <em>recipes</em> package. We first tell the recipes that there is an additional value for the neighborhood in these data, then direct it to create dummy variables for all categorical predictors. In cases where there are no levels observed for a factor, we eliminate predictors with a single unique value, then estimate a transformation that will make the predictor distributions more symmetric. After these, the data are centered and scaled. These same transformations will be applied to the new data points using the statistics estimated from the training set.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">recipes</span>)
<span class="co">#&gt; Warning: package 'recipes' was built under R version 3.6.2</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)

<span class="no">ames_cols</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">ames_new</span>)

<span class="no">training_data</span> <span class="kw">&lt;-</span>
  <span class="no">ames</span> <span class="kw">%&gt;%</span>
  <span class="co"># For consistency, only analyze the data on new properties</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">one_of</a></span>(<span class="no">ames_cols</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="co"># There is a new neighborhood in ames_new</span>
    <span class="kw">Neighborhood</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">Neighborhood</span>),
    <span class="kw">Neighborhood</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">Neighborhood</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">ames_new</span>$<span class="no">Neighborhood</span>))
  )


<span class="no">training_recipe</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/recipes/man/recipe.html">recipe</a></span>( ~ <span class="no">.</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">training_data</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/recipes/man/step_dummy.html">step_dummy</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/recipes/man/has_role.html">all_nominal</a></span>()) <span class="kw">%&gt;%</span>
  <span class="co"># Remove variables that have the same value for every data point.</span>
  <span class="fu"><a href="https://rdrr.io/pkg/recipes/man/step_zv.html">step_zv</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/recipes/man/has_role.html">all_predictors</a></span>()) <span class="kw">%&gt;%</span>
  <span class="co"># Transform variables to be distributed as Gaussian-like as possible.</span>
  <span class="fu"><a href="https://rdrr.io/pkg/recipes/man/step_YeoJohnson.html">step_YeoJohnson</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/recipes/man/has_role.html">all_numeric</a></span>()) <span class="kw">%&gt;%</span>
  <span class="co"># Normalize numeric data to have a mean of zero and</span>
  <span class="co"># standard deviation of one.</span>
  <span class="fu"><a href="https://rdrr.io/pkg/recipes/man/step_normalize.html">step_normalize</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/recipes/man/has_role.html">all_numeric</a></span>())</pre></body></html></div>
<div id="principal-component-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#principal-component-analysis" class="anchor"></a>Principal Component Analysis</h3>
<p>The following functions in <code>applicable</code> are used for principal component analysis:</p>
<ul>
<li>
<code>apd_pca</code>: computes the principal components that account for up to either 95% or the provided <code>threshold</code> of variability. It also computes the percentiles of the principal components and the mean of each principal component.</li>
<li>
<code>autoplot</code>: plots the distribution function for pcas. You can also provide an optional set of <code>dplyr</code> selectors, such as <code><a href="https://dplyr.tidyverse.org/reference/reexports.html">dplyr::matches()</a></code> or <code><a href="https://dplyr.tidyverse.org/reference/reexports.html">dplyr::starts_with()</a></code>, for selecting which variables should be shown in the plot.</li>
<li>
<code>score</code>: calculates the principal components of the new data and their percentiles as compared to the training data. The number of principal components computed depends on the <code>threshold</code> given at fit time. It also computes the multivariate distance between each principal component and its mean.</li>
</ul>
<p>Let us apply <code>apd_pca</code> modeling function to our data:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">ames_pca</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/apd_pca.html">apd_pca</a></span>(<span class="no">training_recipe</span>, <span class="no">training_data</span>)
<span class="no">ames_pca</span>
<span class="co">#&gt; # Predictors:</span>
<span class="co">#&gt;    50</span>
<span class="co">#&gt; # Principal Components:</span>
<span class="co">#&gt;    118 components were needed</span>
<span class="co">#&gt;    to capture at least 95% of the</span>
<span class="co">#&gt;    total variation in the predictors.</span></pre></body></html></div>
<p>Since no <code>threshold</code> was provided, the function computed the number of principal components that accounted for at most 95% of the total variance.</p>
<p>For illustration, setting <code>threshold = 0.25</code> or 25%, we now need only 10 principal components:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">ames_pca</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/apd_pca.html">apd_pca</a></span>(<span class="no">training_recipe</span>, <span class="no">training_data</span>, <span class="kw">threshold</span> <span class="kw">=</span> <span class="fl">0.25</span>)
<span class="no">ames_pca</span>
<span class="co">#&gt; # Predictors:</span>
<span class="co">#&gt;    50</span>
<span class="co">#&gt; # Principal Components:</span>
<span class="co">#&gt;    10 components were needed</span>
<span class="co">#&gt;    to capture at least 25% of the</span>
<span class="co">#&gt;    total variation in the predictors.</span></pre></body></html></div>
<p>Plotting the distribution function for the PCA scores is also helpful:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span>(<span class="no">ames_pca</span>)</pre></body></html></div>
<p><img src="continuous-data_files/figure-html/autoplot-1.png" width="768" style="display: block; margin: auto;"></p>
<p>You can use regular expressions to plot a smaller subset of the pca statistics:</p>
<p><img src="continuous-data_files/figure-html/unnamed-chunk-5-1.png" width="768"><img src="continuous-data_files/figure-html/unnamed-chunk-5-2.png" width="768"></p>
<p>The <code>score</code> function compares the training data to new samples. Let’s go back to the case where we capture 95% of the variation in the predictors and score the new samples. Since we used the recipe interface, we can give the score function the original data:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">ames_pca</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/apd_pca.html">apd_pca</a></span>(<span class="no">training_recipe</span>, <span class="no">training_data</span>)
<span class="no">pca_score</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/score.html">score</a></span>(<span class="no">ames_pca</span>, <span class="no">ames_new</span>)
<span class="no">pca_score</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">matches</a></span>(<span class="st">"PC00[1-3]"</span>), <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"distance"</span>))
<span class="co">#&gt; # A tibble: 3 x 8</span>
<span class="co">#&gt;   PC001 PC002  PC003 PC001_pctl PC002_pctl PC003_pctl distance distance_pctl</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1 -4.86 0.870 -0.457       87.0       17.7       26.1     6.33          1.85</span>
<span class="co">#&gt; 2 -2.85 0.913  0.360       51.7       19.0       21.0     7.64         17.9 </span>
<span class="co">#&gt; 3 -4.63 0.572 -1.21        84.8       11.7       56.5     7.58         17.1</span></pre></body></html></div>
<p>Notice how the samples, displayed in red, are fairly dissimilar to the training set in the first component:</p>
<p><img src="continuous-data_files/figure-html/unnamed-chunk-6-1.png" width="768"></p>
<p>What is driving the first component? We can look at which predictors have the largest values in the rotation matrix (i.e. the values that define the linear combinations in the PC scores). The top five are:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># `ames_pca$pcs` is the output of `prcomp()`</span>
<span class="no">comp_one</span> <span class="kw">&lt;-</span> <span class="no">ames_pca</span>$<span class="no">pcs</span>$<span class="no">rotation</span>[, <span class="fl">1</span>]
<span class="no">comp_one</span>[<span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">comp_one</span>), <span class="kw">decreasing</span> <span class="kw">=</span> <span class="fl">TRUE</span>)] <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">5</span>)
<span class="co">#&gt;       Year_Built      Garage_Cars Foundation_PConc   Year_Remod_Add      Garage_Area </span>
<span class="co">#&gt;       -0.2537606       -0.2176448       -0.2100323       -0.2050218       -0.2019180</span></pre></body></html></div>
<p>These three houses are extreme in the most influential variable (year built) since they were new homes. The also tend to have fairly large garages:</p>
<p><img src="continuous-data_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
<p>This may be what is driving the first component.</p>
<p>However, the overall distance values are relatively small, which indicates that, overall, these new houses are not outside the mainstream of the data.</p>
</div>
<div id="hat-values" class="section level3">
<h3 class="hasAnchor">
<a href="#hat-values" class="anchor"></a>Hat Values</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Leverage_(statistics)">Hat or leverage values</a> are based on the numerics of linear regression. The measure the distance of a data point to the center of the training set distribution. For example, if the numeric training set matrix was <span class="math inline">\(X_{n \times p}\)</span>, the <em>hat matrix</em> for the training set would be computed using</p>
<p><span class="math display">\[H = X'(X'X)^{-1}X\]</span></p>
<p>The corresponding hat values for the training would be the diagonals of <span class="math inline">\(H\)</span>. These values can be computed using <code><a href="https://rdrr.io/r/stats/influence.measures.html">stats::hatvalues(lm_model)</a></code> but only for an <code>lm</code> model object. Also, it cannot compute the values for new samples.</p>
<p>Suppose that we had a new, unknown sample (as a <span class="math inline">\(p \times 1\)</span> data vector <span class="math inline">\(u\)</span>). The hat value for this sample would be</p>
<p><span class="math display">\[h = u^\intercal(X^\intercal X)^{-1}u\]</span>.</p>
<p>The following functions in <code>applicable</code> are used to compute the hat values of your model:</p>
<ul>
<li>
<code>apd_hat_values</code>: computes the matrix <span class="math inline">\((X^\intercal X)^{-1}\)</span>.</li>
<li>
<code>score</code>: calculates the hat values of new samples and their percentiles.</li>
</ul>
<p>Two caveats for using the hat values:</p>
<ol style="list-style-type: decimal">
<li><p>The numerical methods are less tolerant than PCA. For example, extremely correlated predictors will degrade the ability of the hat values to be effectively used. Also, since an inverse is used, there cannot be an linear dependencies within <span class="math inline">\(X\)</span>. To resolve this the former example, the recipe step <code><a href="https://rdrr.io/pkg/recipes/man/step_corr.html">recipes::step_corr()</a></code> can be used to reduce correlation. For the latter issue, <code>recipes::step_lincomp()</code> will identify and remove linear dependencies in the data (as shown below).</p></li>
<li><p>When using a linear or logistic model, the model adds an intercept columns of ones to <span class="math inline">\(X\)</span>. For equivalent computations, you should add a vector or ones to the data or use <code><a href="https://rdrr.io/pkg/recipes/man/step_intercept.html">recipes::step_intercept()</a></code>.</p></li>
</ol>
<p>Let us apply <code>apd_hat_values</code> modeling function to our data (while ensuring that there are no linear dependencies):</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">non_singular_recipe</span> <span class="kw">&lt;-</span>
  <span class="no">training_recipe</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/recipes/man/step_lincomb.html">step_lincomb</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/recipes/man/has_role.html">all_predictors</a></span>())

<span class="co"># Recipe interface</span>
<span class="no">ames_hat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/apd_hat_values.html">apd_hat_values</a></span>(<span class="no">non_singular_recipe</span>, <span class="no">training_data</span>)</pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="tidyverse">
  <p>applicable is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Marly Gotti, Max Kuhn.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
